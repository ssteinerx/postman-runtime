<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>authorizer/index.js - Postman Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home 6.2.6-beta.1</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-architecture.html">Architecture</a></li><li><a href="tutorial-components.html">Postman Runtime Components</a></li><li><a href="tutorial-new-auth-mechanisms.html">New Authentication Mechanisms</a></li><li><a href="tutorial-request-send-flow.html">Request Send Flow</a></li></ul><h3>Classes</h3><ul><li><a href="Authorizer.html">Authorizer</a><ul class='methods'><li data-type='method'><a href="Authorizer.html#.addHandler">addHandler</a></li><li data-type='method'><a href="Authorizer.html#.removeHandler">removeHandler</a></li><li data-type='method'><a href="Authorizer.html#init">init</a></li><li data-type='method'><a href="Authorizer.html#isInteractive">isInteractive</a></li><li data-type='method'><a href="Authorizer.html#postVerify">postVerify</a></li><li data-type='method'><a href="Authorizer.html#preVerify">preVerify</a></li><li data-type='method'><a href="Authorizer.html#sign">sign</a></li></ul></li><li><a href="Cursor.html">Cursor</a></li><li><a href="global.html#Run">Run</a><ul class='methods'><li data-type='method'><a href="global.html#Run#abort">abort</a></li><li data-type='method'><a href="global.html#Run#pause">pause</a></li><li data-type='method'><a href="global.html#Run#resume">resume</a></li></ul></li><li><a href="Runner.html">Runner</a></li><li><a href="Run-module_Instructions-pool-Instruction.html">Instruction</a><ul class='methods'><li data-type='method'><a href="Run-module_Instructions-pool-Instruction.html#.create">create</a></li><li data-type='method'><a href="Run-module_Instructions-pool-Instruction.html#execute">execute</a></li></ul></li><li><a href="Run-module_Timer-Timings.html">Timings</a><ul class='methods'><li data-type='method'><a href="Run-module_Timer-Timings.html#.create">create</a></li><li data-type='method'><a href="Run-module_Timer-Timings.html#record">record</a></li><li data-type='method'><a href="Run-module_Timer-Timings.html#toObject">toObject</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="Run-module_Instructions.html">Instructions</a><ul class='methods'><li data-type='method'><a href="Run-module_Instructions.html#~pool">pool</a></li></ul></li><li><a href="Run-module_Timer.html">Timer</a></li></ul><h3>Global</h3><ul><li><a href="global.html#bof">bof</a></li><li><a href="global.html#bounds">bounds</a></li><li><a href="global.html#box">box</a></li><li><a href="global.html#clear">clear</a></li><li><a href="global.html#commands">commands</a></li><li><a href="global.html#connect">connect</a></li><li><a href="global.html#cr">cr</a></li><li><a href="global.html#create">create</a></li><li><a href="global.html#createContext">createContext</a></li><li><a href="global.html#current">current</a></li><li><a href="global.html#empty">empty</a></li><li><a href="global.html#eof">eof</a></li><li><a href="global.html#FUNCTION">FUNCTION</a></li><li><a href="global.html#hasChanged">hasChanged</a></li><li><a href="global.html#initialisers">initialisers</a></li><li><a href="global.html#interrupt">interrupt</a></li><li><a href="global.html#load">load</a></li><li><a href="global.html#lookup">lookup</a></li><li><a href="global.html#meetExpectations">meetExpectations</a></li><li><a href="global.html#next">next</a></li><li><a href="global.html#prepareLookupHash">prepareLookupHash</a></li><li><a href="global.html#queue">queue</a></li><li><a href="global.html#REQUEST_MODES">REQUEST_MODES</a></li><li><a href="global.html#reset">reset</a></li><li><a href="global.html#run">run</a></li><li><a href="global.html#seek">seek</a></li><li><a href="global.html#setCertificate">setCertificate</a></li><li><a href="global.html#setProxy">setProxy</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#toChromeCookie">toChromeCookie</a></li><li><a href="global.html#transformMultiValueHeaders">transformMultiValueHeaders</a></li><li><a href="global.html#triggers">triggers</a></li><li><a href="global.html#valueOf">valueOf</a></li><li><a href="global.html#whatnext">whatnext</a></li><li><a href="global.html#zero">zero</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">authorizer/index.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var _ = require('lodash'),
    sdk = require('postman-collection'),

    AUTH_TYPE_PROP = '__auth_type',

    PRE = 'pre',
    POST = 'post',
    INIT = 'init',
    DOT_AUTH = '.auth',

    arraySlice = Array.prototype.slice,

    Authorizer;

/**
 * @callback Authorizer~callback
 * @param {Error} err - Errors that occur during construction
 * @param {Authorizer} - The created instance of the authorizer
 */
/**
 * This class manages all authorizations.
 *
 * @param {Object=} options
 * @param {Boolean=} options.interactive - Controls interactive vs non-interactive behavior.
 * @param {Authorizer~callback} callback
 * @constructor
 */
Authorizer = function (options, callback) {
    if (!callback &amp;&amp; _.isFunction(options)) {
        callback = options;
        options = undefined;
    }

    var interactive = options &amp;&amp; options.interactive;

    // if options.interactive is a boolean, make an object out of it, { 'authtype': bool }, else just use it directly.
    this.interactive = !_.isObject(interactive) ?
        _.transform(Authorizer.Handlers, function (accumulator, handler, name) {
            accumulator[name] = Boolean(interactive);
        }, {}) :
        interactive;

    callback(null, this);
};

_.assign(Authorizer.prototype, /** @lends Authorizer.prototype */ {

    /**
     * Checks if a given auth is enabled.
     *
     * @param {RequestAuthBase} auth
     * @returns {Boolean}
     */
    isInteractive: function (auth) {
        var type = _.get(auth, AUTH_TYPE_PROP);

        return type &amp;&amp; _.get(this.interactive, type, false);
    },

    /**
     * Checks whether required parameters are present, and takes the appropriate next step.
     *
     * @param context
     * @param run
     * @param callback
     */
    preVerify: function (context, run, callback) {
        var handler = context.auth;

        if (!this.isInteractive(handler)) {
            // fine, no authentication is to be performed.
            return callback(null, true);
        }

        run.requester.create({
            type: 'http', // @todo - how can the auth declare what type it needs?
            source: _.get(handler, AUTH_TYPE_PROP, PRE) + DOT_AUTH
        }, function (err, requester) {
            if (err) { return callback(err); }

            handler.pre(context, requester, function () {
                requester.dispose(); // todo - when this becomes async, call the callback after dispose.
                callback.apply(run, arraySlice.call(arguments));
            });
        });
    },

    /**
     * "Initializes" a request, in turn performing whatever steps are necessary for the
     * authorization to go forward (fetching extra params, prompting user, etc).
     *
     * @param context
     * @param run
     * @param callback
     */
    init: function (context, run, callback) {
        var handler = context.auth;

        if (!this.isInteractive(handler)) {
            // fine, no authentication is to be performed.
            return callback(null, true);
        }

        run.requester.create({
            type: 'http', // @todo - how can the auth declare what type it needs?
            source: _.get(handler, AUTH_TYPE_PROP, INIT) + DOT_AUTH
        }, function (err, requester) {
            if (err) { return callback(err); }

            handler.init(context, requester, function () {
                requester.dispose(); // todo - when this becomes async, call the callback after dispose.
                callback.apply(run, arraySlice.call(arguments));
            });
        });
    },

    /**
     * Actually performs the signing step, calling the correct signature generators.
     *
     * @param context
     * @param run
     * @param callback
     */
    sign: function (context, run, callback) {
        var handler = context.auth;

        try {
            // @todo - this should not be _sign, we need to fix the API once SDK auth is separate.
            handler &amp;&amp; (context.item.request = handler._sign(context.item.request));
        }
        catch (e) {
            return callback(e);
        }

        return callback(null);
    },

    /**
     * Checks whether required parameters are present, and takes the appropriate next step.
     *
     * @param context
     * @param run
     * @param callback
     */
    postVerify: function (context, run, callback) {
        var handler = context.auth;

        if (!this.isInteractive(handler)) {
            // fine, no authentication is to be performed.
            return callback(null, true);
        }

        run.requester.create({
            type: 'http', // @todo - how can the auth declare what type it needs?
            source: _.get(handler, AUTH_TYPE_PROP, POST) + DOT_AUTH
        }, function (err, requester) {
            if (err) { return callback(err); }

            handler.post(context, requester, function () {
                requester.dispose(); // todo - when this becomes async, call the callback after dispose.
                callback.apply(run, arraySlice.call(arguments));
            });
        });
    }
});

_.assign(Authorizer, /** @lends Authorizer */ {

    /**
     * All the built-in auth methods.
     *
     * @enum {Object}
     */
    Handlers: {},

    create: function (options, callback) {
        return new Authorizer(options, callback);
    },

    /**
     * Allow injecting custom auth types (helps with testing)
     *
     * @param Handler
     * @param name
     */
    addHandler: function (Handler, name) {
        var Signer = sdk.RequestAuth.types[name];
        if (!Signer) {
            // @todo we have a handler, but no corresponding SDK Signer, what do we do now? :/
            return;
        }

        if (!_.isFunction(Handler.init)) {
            throw new Error('The handler for "' + name + '" does not have an "init" function, which is necessary');
        }

        if (!_.isFunction(Handler.pre)) {
            throw new Error('The handler for "' + name + '" does not have a "pre" function, which is necessary');
        }

        if (!_.isFunction(Handler.post)) {
            throw new Error('The handler for "' + name + '" does not have a "post" function, which is necessary');
        }

        if (!_.isFunction(Handler._sign)) {
            throw new Error('The handler for "' + name + '" does not have a "_sign" function, which is necessary');
        }

        _.assign(Signer.prototype, Handler);

        Object.defineProperty(Signer.prototype, AUTH_TYPE_PROP, {
            value: name,
            configurable: false,
            enumerable: false,
            writable: false
        });

        Authorizer.Handlers[name] = Signer;
    },

    /**
     * Allow injecting custom auth types (helps with testing)
     *
     * @param name
     */
    removeHandler: function (name) {
        Authorizer.Handlers[name] &amp;&amp; (delete Authorizer.Handlers[name]);
    }
});

// Create a Handler from each Signer that the SDK provides. Basically, we augment the signers with extra
// helper functions which take over the job of preparing a request for signing.
_.forEach({
    awsv4: require('./aws4'),
    basic: require('./basic'),
    digest: require('./digest'),
    hawk: require('./hawk'),
    oauth1: require('./oauth1'),
    oauth2: require('./oauth2'),
    ntlm: require('./ntlm')
}, Authorizer.addHandler);

module.exports.Authorizer = Authorizer;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated at Mon Jul 24 2017 12:14:31 GMT+0000 (UTC)
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
